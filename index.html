<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Badminton Randomizer</title>
<style>
  body { font-family: sans-serif; margin: 0; padding: 16px; background: #eef1f7; }
  .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
  .cell {
    background: white;
    border: 2px solid #d0d4e4;
    border-radius: 16px;
    padding: 0;
    aspect-ratio: 1 / 1;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    transition: 0.25s;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  }
  @media (max-width: 480px) {
    .cell { font-size: 24px; }
  }
  .active {
    background: #4f46e5;
    color: white;
    transform: scale(1.15);
    box-shadow: 0 8px 16px rgba(79,70,229,0.4);
  }
  button { padding: 10px 16px; margin: 4px; border-radius: 8px; border: none; cursor: pointer; }
  .btn-main { background: #16a34a; color: white; }
  .btn-stop { background: #dc2626; color: white; }
  .history-box { background: white; border: 1px solid #ccc; border-radius: 8px; padding: 8px; max-height: 200px; overflow-y: auto; }
</style>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4f46e5">
<link rel="apple-touch-icon" href="icon.png">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</head>
<body>
<h2>Badminton Direction Randomizer</h2>

<div id="grid" class="grid"></div>
<br/>

<label>Repeats: <input id="repeat" type="number" value="10" min="1"></label><br/><br/>
<label>Interval (ms): <input id="interval" type="number" value="1500" min="200"></label><br/><br/>
<label><input id="autoMode" type="checkbox"> Auto Mode</label><br/>
<label><input id="feint" type="checkbox"> Feint Mode</label><br/><br/>

<button id="startBtn" class="btn-main">Start</button>
<button id="stopBtn" class="btn-stop">Stop</button>

<p>Current: <span id="current">-</span></p>
<p>Remaining: <span id="remain">-</span></p>

<h3>History</h3>
<div id="history" class="history-box"></div>

<script>
const DIRECTIONS = ["+","+","+","+","","+","+","+","+"];

const grid = document.getElementById('grid');
const currentEl = document.getElementById('current');
const remainEl = document.getElementById('remain');
const historyEl = document.getElementById('history');

let timer = null;
let feintTimer = null;
let running = false;
let total = 0;
let left = 0;

function renderGrid(activeIds=[]) {
  grid.innerHTML = '';
  DIRECTIONS.forEach((label, i) => {
    const div = document.createElement('div');
    div.className = 'cell' + (activeIds.includes(i) ? ' active' : '');
    div.innerHTML = label;
    grid.appendChild(div);
  });
}
renderGrid();

function pick(exclude=null) {
  let pool = [...Array(9).keys()].filter(i => i !== exclude);
  return pool[Math.floor(Math.random()*pool.length)];
}

function makeSeq() {
  const isFeint = Math.random() < 0.3;
  if (!isFeint) return [pick()];

  const count = Math.floor(Math.random()*4) + 1;
  let seq = [];
  let prev = null;

  for (let i=0;i<count;i++) {
    let n = pick(prev);
    seq.push(n);
    prev = n;
  }
  return seq;
}

function playOnce(record=true) {
  const seq = makeSeq();

  const last = seq[seq.length - 1];

  let index = 0;
  function playStep() {
    if (index < seq.length - 1) {
      renderGrid([seq[index]]);
      currentEl.textContent = "…";
      index++;
      feintTimer = setTimeout(playStep, 200);
    } else {
      renderGrid([last]);
      currentEl.textContent = DIRECTIONS[last];
      if (record) addHistory(seq);
    }
  }
  playStep();
}

function addHistory(seq) {
  const item = document.createElement('div');
  item.textContent = new Date().toLocaleTimeString() + ' — ' + seq.map(i=>DIRECTIONS[i]).join(' → ');
  historyEl.prepend(item);
}

function start() {
  if (running) return;
  running = true;
  total = parseInt(document.getElementById('repeat').value)||1;
  left = total;
  remainEl.textContent = left;

  const auto = document.getElementById('autoMode').checked;
  playOnce();
  left--;
  remainEl.textContent = left;

  if (auto) {
    const interval = Math.max(200, parseInt(document.getElementById('interval').value)||1500);
    timer = setInterval(() => {
      if (left <= 0) { stop(); return; }
      playOnce();
      left--;
      remainEl.textContent = left;
    }, interval);
  }
}

function stop() {
  running = false;
  clearInterval(timer);
  clearTimeout(feintTimer);
  remainEl.textContent = '-';
}

document.getElementById('startBtn').onclick = start;
document.getElementById('stopBtn').onclick = stop;
</script>
</body>
</html>
